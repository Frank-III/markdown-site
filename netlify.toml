[build]
  command = "bun install && npx convex deploy --cmd 'bun run build'"
  publish = "build"

[build.environment]
  NODE_VERSION = "20"

# Edge functions for dynamic Convex HTTP proxying
# RSS feeds
[[edge_functions]]
  path = "/rss.xml"
  function = "rss"

[[edge_functions]]
  path = "/rss-full.xml"
  function = "rss"

# Sitemap
[[edge_functions]]
  path = "/sitemap.xml"
  function = "sitemap"

# API endpoints
[[edge_functions]]
  path = "/api/posts"
  function = "api"

[[edge_functions]]
  path = "/api/post"
  function = "api"

[context.production.environment]
  NODE_ENV = "production"

[context.deploy-preview.environment]
  NODE_ENV = "development"

[context.branch-deploy.environment]
  NODE_ENV = "development"
